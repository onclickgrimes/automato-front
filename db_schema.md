CREATE TABLE public.execution_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  routine_id uuid,
  social_account_id uuid,
  action_type text NOT NULL,
  status text NOT NULL DEFAULT 'pending'::text,
  result jsonb DEFAULT '{}'::jsonb,
  error_message text,
  started_at timestamp with time zone DEFAULT now(),
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT execution_logs_pkey PRIMARY KEY (id),
  CONSTRAINT execution_logs_social_account_id_fkey FOREIGN KEY (social_account_id) REFERENCES public.instagram_accounts(id),
  CONSTRAINT execution_logs_routine_id_fkey FOREIGN KEY (routine_id) REFERENCES public.routines(id),
  CONSTRAINT execution_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.instagram_accounts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  username character varying NOT NULL,
  auth_type character varying NOT NULL CHECK (auth_type::text = ANY (ARRAY['credentials'::character varying, 'cookie'::character varying]::text[])),
  is_logged_in boolean DEFAULT false,
  is_monitoring boolean DEFAULT false,
  login_time timestamp with time zone,
  logout_time timestamp with time zone,
  monitor_started_at timestamp with time zone,
  monitor_stopped_at timestamp with time zone,
  monitor_keywords ARRAY,
  auto_reply_enabled boolean DEFAULT false,
  auto_reply_message text,
  cookie text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT instagram_accounts_pkey PRIMARY KEY (id),
  CONSTRAINT instagram_accounts_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.instagram_actions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  account_id uuid NOT NULL,
  action_type character varying NOT NULL CHECK (action_type::text = ANY (ARRAY['like'::character varying, 'comment'::character varying, 'follow'::character varying, 'unfollow'::character varying, 'upload'::character varying, 'message'::character varying]::text[])),
  target_url text,
  target_username character varying,
  comment_text text,
  result jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT instagram_actions_pkey PRIMARY KEY (id),
  CONSTRAINT instagram_actions_account_id_fkey FOREIGN KEY (account_id) REFERENCES public.instagram_accounts(id),
  CONSTRAINT instagram_actions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.instagram_messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  account_id uuid NOT NULL,
  sender_username character varying NOT NULL,
  message_text text NOT NULL,
  message_id character varying,
  is_read boolean DEFAULT false,
  contains_keyword boolean DEFAULT false,
  matched_keyword character varying,
  auto_replied boolean DEFAULT false,
  reply_message text,
  received_at timestamp with time zone DEFAULT now(),
  replied_at timestamp with time zone,
  CONSTRAINT instagram_messages_pkey PRIMARY KEY (id),
  CONSTRAINT instagram_messages_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT instagram_messages_account_id_fkey FOREIGN KEY (account_id) REFERENCES public.instagram_accounts(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  email text,
  full_name text,
  avatar_url text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.proxies (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  name text NOT NULL,
  address text NOT NULL,
  port integer NOT NULL,
  username text,
  password text,
  proxy_type text DEFAULT 'http'::text,
  is_active boolean DEFAULT true,
  status USER-DEFINED DEFAULT 'inactive'::proxy_status,
  last_tested timestamp with time zone,
  response_time integer,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT proxies_pkey PRIMARY KEY (id),
  CONSTRAINT proxies_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.routines (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  trigger_type USER-DEFINED NOT NULL DEFAULT 'manual'::trigger_type,
  trigger_config jsonb DEFAULT '{}'::jsonb,
  actions jsonb NOT NULL DEFAULT '[]'::jsonb,
  is_active boolean DEFAULT true,
  status USER-DEFINED DEFAULT 'active'::routine_status,
  social_account_id uuid,
  proxy_id uuid,
  last_executed timestamp with time zone,
  next_execution timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT routines_pkey PRIMARY KEY (id),
  CONSTRAINT routines_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT routines_social_account_id_fkey FOREIGN KEY (social_account_id) REFERENCES public.instagram_accounts(id),
  CONSTRAINT routines_proxy_id_fkey FOREIGN KEY (proxy_id) REFERENCES public.proxies(id)
);